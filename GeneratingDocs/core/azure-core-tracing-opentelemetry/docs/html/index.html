<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>azure-core-tracing-opentelemetry: Azure SDK Core Tracing Library for C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-62780441-44"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-62780441-44');
</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<script>
WINDOW_CONTENTS = window.location.href.split("/");
// language specific
SELECTED_LANGUAGE = "cpp";
populateOptions("#versionSelector", [
  "#versionSelector",
  "#versionSelectorHeader"
]);
function currentVersion() {
  // Filled in by Doxygen template
  return "1.0.0-beta.5";
}
function currentPackage() {
  // Filled in by Doxygen template
  return "azure-core-tracing-opentelemetry";
}
function httpGetAsync(targetUrl, callback) {
  var xmlHttp = new XMLHttpRequest();
  xmlHttp.onreadystatechange = function() {
    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
      callback(xmlHttp.responseText);
  };
  xmlHttp.open("GET", targetUrl, true); // true for asynchronous
  xmlHttp.send(null);
}
function showSelectors(selectors) {
  selectors.forEach(function(item, index) {
    $(item).show();
  });
}
function hideSelectors(selectors) {
  selectors.forEach(function(item, index) {
    $(item).hide();
  });
}
function populateOptions(optionSelector, otherSelectors) {
  if (currentPackage()) {
    var versionRequestUrl =
      "https://azuresdkdocs.blob.core.windows.net/$web/" +
      SELECTED_LANGUAGE +
      "/" +
      currentPackage() +
      "/versioning/versions";
    httpGetAsync(versionRequestUrl, function(responseText) {
      if (responseText) {
        let options = responseText.match(/[^\r\n]+/g);
        populateVersionDropDown(optionSelector, options);
        showSelectors(otherSelectors);
        $(optionSelector).change(function() {
          targetVersion = $(this).val();
          window.location.href = getPackageUrl(SELECTED_LANGUAGE, currentPackage(), targetVersion);
        });
      }
    });
  }
}
function populateVersionDropDown(selector, values) {
  var select = $(selector);
  $("option", select).remove();
  $.each(values, function(index, text) {
    $("<option/>", { value: text, text: text }).appendTo(select);
  });
  select.val(currentVersion());
}
function getPackageUrl(language, package, version) {
  return (
    "https://azuresdkdocs.blob.core.windows.net/$web/" +
    language +
    "/" +
    package +
    "/" +
    version +
    "/index.html"
  );
}
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo">
    <img alt="Logo" src="logo.svg"/>
  </td>
  <td id="projectalign">
   <div id="projectname">
    <div class="navbrand">
    </div>
    azure-core-tracing-opentelemetry
    <span id="projectnumber">
      <span id="versionSelectorHeader">
        <span>
            <select id="versionSelector">
                <option>1.0.0-beta.5</option>
            </select>
        </span>
      </span>
    </span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Azure SDK Core Tracing Library for C++ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> Azure::Core::Tracing::OpenTelemetry (<code>azure-core-tracing-opentelemetry</code>) provides an implementation to enable customers to implement tracing in the Azure SDK for C++ libraries.</p>
<h1><a class="anchor" id="getting-started"></a>
Getting started</h1>
<h2><a class="anchor" id="include-the-package"></a>
Include the package</h2>
<p>The easiest way to acquire the OpenTelemetry library is leveraging vcpkg package manager. See the corresponding <a href="https://github.com/Azure/azure-sdk-for-cpp#download--install-the-sdk">Azure SDK for C++ readme section</a>.</p>
<p>To install Azure Core OpenTelemetry package via vcpkg:</p>
<div class="fragment"><div class="line">&gt; vcpkg install azure-core-tracing-opentelemetry-cpp</div>
</div><!-- fragment --><p>Then, use in your CMake file:</p>
<div class="fragment"><div class="line">find_package(azure-core-tracing-opentelemetry-cpp CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(&lt;your project name&gt; PRIVATE Azure::azure-core-tracing-opentelemetry)</div>
</div><!-- fragment --><h1><a class="anchor" id="key-concepts"></a>
Key concepts</h1>
<p>The <code>azure-core-tracing-opentelemetry</code> package supports enabling tracing for Azure SDK packages, using an <a href="https://opentelemetry.io/">OpenTelemetry</a> <code>Tracer</code>.</p>
<p>By default, all libraries log with a <code>NoOpTracer</code> that takes no action. To enable tracing, you will need to set a global tracer provider following the instructions in the <a href="https://opentelemetry-cpp.readthedocs.io/en/latest/api/GettingStarted.html">OpenTelemetry getting started guide</a> or the <a class="el" href="#enabling-tracing-using-opentelemetry">Enabling Tracing using OpenTelemetry example</a> below.</p>
<h2><a class="anchor" id="span-propagation"></a>
Span Propagation</h2>
<p>Core Tracing supports both automatic and manual span propagation. Automatic propagation is handled using OpenTelemetry's API and will work well in most scenarios.</p>
<p>For customers who require manual propagation, all client library operations accept an optional field in the <code>options</code> parameter where a tracingContext can be passed in and used as the currently active context. Please see the <a class="el" href="#manual-span-propagation-using-opentelemetry">Manual Span Propagation example</a> below for more details.</p>
<h2><a class="anchor" id="opentelemetry-compatibility"></a>
OpenTelemetry Compatibility</h2>
<p>Most Azure SDKs use <a href="https://opentelemetry.io/">OpenTelemetry</a> to support tracing. Specifically, we depend on the <a href="https://github.com/open-telemetry/opentelemetry-cpp/blob/main/docs/building-with-vcpkg.md">opentelemetry-cpp</a> VCPKG package.</p>
<h1><a class="anchor" id="examples"></a>
Examples</h1>
<h2><a class="anchor" id="enabling-tracing-using-opentelemetry"></a>
Enabling tracing using OpenTelemetry</h2>
<div class="fragment"><div class="line"><span class="comment">// Start by creating an OpenTelemetry Provider using the</span></div>
<div class="line"><span class="comment">// default OpenTelemetry tracer provider.</span></div>
<div class="line">std::shared_ptr&lt;Azure::Core::Tracing::TracerProvider&gt; tracerProvider = Azure::Core::OpenTelemetry::TracerProvider::Create();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Connect the tracerProvider to the current application context.</span></div>
<div class="line">ApplicationContext().SetTracerProvider(tracerProvider);</div>
</div><!-- fragment --><p>After this, the SDK API implementations will be able to retrieve the tracer provider and produce tracing events automatically.</p>
<h2><a class="anchor" id="enabling-tracing-using-a-non-default-tracerprovider"></a>
Enabling tracing using a non-default TracerProvider</h2>
<div class="fragment"><div class="line"><span class="comment">// Start by creating an OpenTelemetry Provider.</span></div>
<div class="line"><span class="keyword">auto</span> exporter = std::make_unique&lt;MySpanExporter&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// simple processor</span></div>
<div class="line"><span class="keyword">auto</span> simple_processor = std::unique_ptr&lt;opentelemetry::sdk::trace::SpanProcessor&gt;(</div>
<div class="line">    <span class="keyword">new</span> opentelemetry::sdk::trace::SimpleSpanProcessor(std::move(exporter)));</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> always_on_sampler = std::unique_ptr&lt;opentelemetry::sdk::trace::AlwaysOnSampler&gt;(</div>
<div class="line">    <span class="keyword">new</span> opentelemetry::sdk::trace::AlwaysOnSampler);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> resource_attributes = opentelemetry::sdk::resource::ResourceAttributes{</div>
<div class="line">    {<span class="stringliteral">&quot;service.name&quot;</span>, <span class="stringliteral">&quot;telemetryTest&quot;</span>}, {<span class="stringliteral">&quot;service.instance.id&quot;</span>, <span class="stringliteral">&quot;instance-1&quot;</span>}};</div>
<div class="line"><span class="keyword">auto</span> resource = opentelemetry::sdk::resource::Resource::Create(resource_attributes);</div>
<div class="line"><span class="keyword">auto</span> openTelemetryProvider = opentelemetry::nostd::shared_ptr&lt;opentelemetry::trace::TracerProvider&gt;(</div>
<div class="line">        <span class="keyword">new</span> opentelemetry::sdk::trace::TracerProvider(</div>
<div class="line">            std::move(simple_processor), resource, std::move(always_on_sampler)));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use the default OpenTelemetry tracer provider.</span></div>
<div class="line">std::shared_ptr&lt;Azure::Core::Tracing::TracerProvider&gt; tracerProvider = </div>
<div class="line">    Azure::Core::OpenTelemetry::TracerProvider::Create(openTelemetryProvider);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Connect the tracerProvider to the current application context.</span></div>
<div class="line">ApplicationContext().SetTracerProvider(tracerProvider);</div>
</div><!-- fragment --><h2><a class="anchor" id="manual-span-propagation-using-opentelemetry"></a>
Manual Span Propagation using OpenTelemetry</h2>
<p>In Azure Service methods, the <code>Azure::Context</code> value passed into the tracer optionally has an associated Span.</p>
<p>If there is a span associated with the <code>Azure::Context</code>, then calling <code>DiagnosticTracingFactory::CreateSpanFromContext</code> will cause a new span to be created using the span in the provided <code>Azure::Context</code> object as the parent span.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> contextAndSpan</div>
<div class="line">    = Azure::Core::Tracing::_internal::DiagnosticTracingFactory::CreateSpanFromContext(</div>
<div class="line">        <span class="stringliteral">&quot;HTTP GET#2&quot;</span>, context);</div>
</div><!-- fragment --><h1><a class="anchor" id="next-steps"></a>
Next steps</h1>
<p>You can build and run the tests locally by executing <code>azure-core-tracing-opentelemetry-test</code>. Explore the <code>test</code> folder to see advanced usage and behavior of the public classes.</p>
<h1><a class="anchor" id="troubleshooting"></a>
Troubleshooting</h1>
<p>If you run into issues while using this library, please feel free to <a href="https://github.com/Azure/azure-sdk-for-cpp/issues/new">file an issue</a>.</p>
<h2><a class="anchor" id="opentelemetry-compatibility-errors"></a>
OpenTelemetry Compatibility Errors</h2>
<blockquote class="doxtable">
<p>&zwj;Ideally you'd want to use OpenTelemetry 1.3.0 or higher. </p>
</blockquote>
<h2><a class="anchor" id="reporting-security-issues-and-security-bugs"></a>
Reporting security issues and security bugs</h2>
<p>Security issues and bugs should be reported privately, via email, to the Microsoft Security Response Center (MSRC) <a href="#" onclick="location.href='mai'+'lto:'+'sec'+'ur'+'e@m'+'ic'+'ros'+'of'+'t.c'+'om'; return false;">secur<span class="obfuscator">.nosp@m.</span>e@mi<span class="obfuscator">.nosp@m.</span>croso<span class="obfuscator">.nosp@m.</span>ft.c<span class="obfuscator">.nosp@m.</span>om</a>. You should receive a response within 24 hours. If for some reason you do not, please follow up via email to ensure we received your original message. Further information, including the MSRC PGP key, can be found in the <a href="https://www.microsoft.com/msrc/faqs-report-an-issue">Security TechCenter</a>.</p>
<h2><a class="anchor" id="license"></a>
License</h2>
<p>Azure SDK for C++ is licensed under the <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/main/LICENSE.txt">MIT</a> license.</p>
<p><img src="https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-cpp%2Fsdk%2Fcore%2Fcore-opentelemetry%2FREADME.png" alt="Impressions" class="inline"/> </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.9.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
